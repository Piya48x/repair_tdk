-- Create the tickets table
create table public.tickets (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  
  -- Core Request Info
  title text not null,
  description text,
  category text, -- e.g., 'Hardware', 'Software'
  service_type text, -- e.g., 'req_laptop_gps'
  priority text default 'normal', -- 'low', 'normal', 'high', 'critical'
  status text default 'NEW', -- 'NEW', 'IN_PROGRESS', 'COMPLETED', 'REJECTED'
  
  -- Requester Context
  reporter_name text,
  reporter_email text,
  reporter_phone text,
  department text,
  location text,
  
  -- GPS / Asset Tracking Specifics
  borrow_start_date date,
  borrow_end_date date,
  purpose_of_use text,
  laptop_serial_number text, -- Filled by IT Admin later
  
  -- Metadata
  closed_at timestamp with time zone,
  assigned_to uuid references auth.users(id)
);

-- Enable Row Level Security (RLS)
alter table public.tickets enable row level security;

-- Policy: Users can see their own tickets
create policy "Users can view their own tickets"
on public.tickets for select
using (auth.email() = reporter_email);

-- Policy: Users can insert tickets
create policy "Users can create tickets"
on public.tickets for insert
with check (true);
